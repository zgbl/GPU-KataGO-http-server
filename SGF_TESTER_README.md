# SGF 测试工具说明

本项目提供了多个SGF测试工具，用于验证KataGo HTTP服务器的分析功能。

## 🎯 推荐使用 (当前版本)

✅ **sgf_test_claude.py** - **主要推荐**
- 适配新的Analysis服务器API格式
- 支持详细分析模式
- 完整的SGF解析和逐步分析
- 优化的数据展示格式
- 增强的调试功能

🔧 **使用方法**:
```bash
python sgf_test_claude.py
```

选择选项:
- `1` - 输入自定义SGF内容
- `2` - 使用内置示例SGF (推荐测试)
- `3` - 设置分析间隔
- `4` - 测试服务器连接
- `5` - 退出

# SGF HTTP 测试工具

这是一个专门为 KataGo HTTP Server 设计的 SGF 棋谱分析测试工具，支持手动输入 SGF 棋谱并进行逐步分析。

## 功能特性

- 🎯 **SGF 解析**: 自动解析 SGF 格式的围棋棋谱
- 🧠 **逐步分析**: 按手数逐步分析每一手棋的局面
- ⏱️ **定时反馈**: 可设置分析间隔，每隔指定时间显示一步分析结果
- 🔄 **交互模式**: 友好的交互界面，支持多种操作选项
- 📊 **详细信息**: 显示推荐走法、胜率、分差等分析数据
- 🌐 **HTTP API**: 基于 HTTP API 与 KataGo 服务器通信

## 文件说明

- `sgf_test_claude.py` - 主要的 SGF HTTP 测试工具
- `SGF_TESTER_README.md` - 本说明文档

## 使用方法

### 1. 确保服务器运行

首先确保 KataGo HTTP Server 正在运行：

```bash
# 检查容器状态
docker ps --filter "name=katago"

# 如果没有运行，启动服务器
./build_and_run.sh
```

### 2. 交互模式使用

运行主测试工具进入交互模式：

```bash
python sgf_http_tester.py
```

交互界面提供以下选项：

1. **输入SGF内容进行分析** - 手动粘贴 SGF 棋谱内容
2. **使用示例SGF** - 使用内置的示例棋谱进行测试
3. **设置分析间隔** - 调整每步分析之间的等待时间（默认5秒）
4. **测试服务器连接** - 检查与 KataGo 服务器的连接状态
5. **退出** - 退出程序

### 3. 演示模式使用

运行演示脚本查看完整功能演示：

```bash
# 完整演示（分析前5手棋）
python demo_sgf_tester.py

# 快速测试（仅测试基本功能）
python demo_sgf_tester.py --quick
```

### 4. SGF 格式要求

工具支持标准的 SGF 格式，例如：

```sgf
(;FF[4]CA[UTF-8]GM[1]DT[2024-01-01]
SZ[19]KM[7.5]PW[White]PB[Black]
;B[pd];W[dd];B[pq];W[dp];B[fq];W[cn];B[jp];W[qf]
;B[nd];W[rd];B[qc];W[qi])
```

## 分析输出说明

每步分析会显示以下信息：

- **第X手**: 当前分析的手数和走法
- **推荐走法**: KataGo 推荐的最佳走法
- **胜率**: 当前局面的胜率评估
- **分差**: 预估的分数差距
- **访问次数**: 分析时的搜索访问次数
- **分析时间**: 本次分析耗费的时间

## 配置选项

### 服务器地址

默认连接到 `http://localhost:8080`，可以通过命令行参数指定其他地址：

```bash
python sgf_http_tester.py http://your-server:port
```

### 分析间隔

在交互模式中可以设置分析间隔时间，或者在代码中修改 `analysis_interval` 参数。

### 分析范围

可以指定分析的手数范围：

- 输入 `10` - 分析前10手
- 输入 `5-15` - 分析第5手到第15手
- 直接回车 - 分析全部手数

## 故障排除

### 连接失败

如果出现连接失败，请检查：

1. KataGo HTTP Server 是否正在运行
2. 服务器地址和端口是否正确
3. 防火墙设置是否阻止连接

```bash
# 检查服务器状态
curl http://localhost:8080/health

# 检查容器日志
docker logs katago-integrated-server
```

### SGF 解析失败

如果 SGF 解析失败，请检查：

1. SGF 格式是否正确
2. 是否包含有效的走法信息
3. 坐标格式是否符合标准（a-s，不包含i）

### 分析超时

如果分析超时，可能的原因：

1. 服务器负载过高
2. 网络连接不稳定
3. KataGo 引擎响应缓慢

## 技术细节

### SGF 坐标转换

工具自动将 SGF 坐标格式转换为 KataGo API 需要的格式：

- SGF: `pd` (小写，a-s，跳过i) → KataGo: `Q16` (大写，A-T，跳过I)
- 行坐标从 SGF 的底部计数转换为 KataGo 的顶部计数

### API 调用

工具使用以下 KataGo HTTP API 端点：

- `GET /health` - 健康检查
- `GET /info` - 服务器信息
- `POST /select-move/katago_gtp_bot` - 获取推荐走法和分析

### 依赖库

- `requests` - HTTP 请求
- `json` - JSON 数据处理
- `re` - 正则表达式（SGF 解析）
- `time` - 时间控制

## 示例输出

```
[16:38:33] 🎯 分析第1手: B Q16
[16:38:34] ✅ 第1手: B Q16 | 推荐走法: R16 | 胜率: N/A | 分差: N/A | 访问次数: N/A | 分析时间: 1.30秒
[16:38:34] 🔵 等待3秒后继续...
[16:38:37] 🎯 分析第2手: W D16
[16:38:44] ✅ 第2手: W D16 | 推荐走法: D16 | 胜率: N/A | 分差: N/A | 访问次数: N/A | 分析时间: 7.07秒
```

## 贡献

欢迎提交问题报告和功能建议。如需修改代码，请确保：

1. 保持代码风格一致
2. 添加适当的注释
3. 测试新功能的正确性

## 许可证

本工具遵循与主项目相同的许可证。